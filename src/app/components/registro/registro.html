<div class="registro-container">
  <div class="registro-form">
    <h2>Registro de Usuario</h2>
    
    <form [formGroup]="registroForm" (ngSubmit)="onRegistro()">
      <div class="form-group">
        <label for="username">Usuario:</label>
        <input 
          type="text" 
          id="username" 
          formControlName="username" 
          placeholder="Ingrese su nombre de usuario"
          [class.invalid]="registroForm.get('username')?.invalid && registroForm.get('username')?.touched"
        >
        <div class="validation-error" *ngIf="registroForm.get('username')?.invalid && registroForm.get('username')?.touched">
          <span *ngIf="registroForm.get('username')?.errors?.['required']">El nombre de usuario es requerido</span>
          <span *ngIf="registroForm.get('username')?.errors?.['minlength']">El nombre de usuario debe tener al menos 4 caracteres</span>
          <span *ngIf="registroForm.get('username')?.errors?.['usernameTaken']">Este nombre de usuario ya está en uso</span>
        </div>
      </div>

      <div class="form-group">
        <label for="password">Contraseña:</label>
        <div class="password-input-container">
          <input 
            [type]="showPassword ? 'text' : 'password'"
            id="password" 
            formControlName="password" 
            placeholder="Ingrese su contraseña"
            [class.invalid]="registroForm.get('password')?.invalid && registroForm.get('password')?.touched"
          >
          <button type="button" class="toggle-password" (click)="showPassword = !showPassword">
            <i class="fas" [class.fa-eye]="!showPassword" [class.fa-eye-slash]="showPassword"></i>
          </button>
        </div>
        <div class="validation-error" *ngIf="registroForm.get('password')?.invalid && registroForm.get('password')?.touched">
          <span *ngIf="registroForm.get('password')?.errors?.['required']">La contraseña es requerida</span>
          <span *ngIf="registroForm.get('password')?.errors?.['minlength']">La contraseña debe tener al menos 8 caracteres</span>
          <span *ngIf="registroForm.get('password')?.errors?.['pattern']">La contraseña debe contener al menos una letra y un número</span>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirmar Contraseña:</label>
        <div class="password-input-container">
          <input 
            [type]="showConfirmPassword ? 'text' : 'password'"
            id="confirmPassword" 
            formControlName="confirmPassword" 
            placeholder="Confirme su contraseña"
            [class.invalid]="(registroForm.get('confirmPassword')?.invalid || registroForm.errors?.['passwordMismatch']) && registroForm.get('confirmPassword')?.touched"
          >
          <button type="button" class="toggle-password" (click)="showConfirmPassword = !showConfirmPassword">
            <i class="fas" [class.fa-eye]="!showConfirmPassword" [class.fa-eye-slash]="showConfirmPassword"></i>
          </button>
        </div>
        <div class="validation-error" *ngIf="(registroForm.get('confirmPassword')?.invalid || registroForm.errors?.['passwordMismatch']) && registroForm.get('confirmPassword')?.touched">
          <span *ngIf="registroForm.get('confirmPassword')?.errors?.['required']">La confirmación de contraseña es requerida</span>
          <span *ngIf="registroForm.errors?.['passwordMismatch']">Las contraseñas no coinciden</span>
        </div>
      </div>

      <div class="form-group">
        <label for="nombre">Nombre:</label>
        <input 
          type="text" 
          id="nombre" 
          formControlName="nombre" 
          placeholder="Ingrese su nombre"
          [class.invalid]="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched"
        >
        <div class="validation-error" *ngIf="registroForm.get('nombre')?.invalid && registroForm.get('nombre')?.touched">
          <span *ngIf="registroForm.get('nombre')?.errors?.['required']">El nombre es requerido</span>
        </div>
      </div>

      <div class="form-group">
        <label for="apellido">Apellido:</label>
        <input 
          type="text" 
          id="apellido" 
          formControlName="apellido" 
          placeholder="Ingrese su apellido"
          [class.invalid]="registroForm.get('apellido')?.invalid && registroForm.get('apellido')?.touched"
        >
        <div class="validation-error" *ngIf="registroForm.get('apellido')?.invalid && registroForm.get('apellido')?.touched">
          <span *ngIf="registroForm.get('apellido')?.errors?.['required']">El apellido es requerido</span>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input 
          type="email" 
          id="email" 
          formControlName="email" 
          placeholder="Ingrese su email"
          [class.invalid]="registroForm.get('email')?.invalid && registroForm.get('email')?.touched"
        >
        <div class="validation-error" *ngIf="registroForm.get('email')?.invalid && registroForm.get('email')?.touched">
          <span *ngIf="registroForm.get('email')?.errors?.['required']">El email es requerido</span>
          <span *ngIf="registroForm.get('email')?.errors?.['email']">Ingrese un email válido</span>
          <span *ngIf="registroForm.get('email')?.errors?.['emailTaken']">Este email ya está registrado</span>
        </div>
      </div>

      <div class="form-group">
        <label for="nacionalidad">Nacionalidad:</label>
        <input 
          type="text" 
          id="nacionalidad" 
          formControlName="nacionalidad" 
          placeholder="Ingrese su nacionalidad"
          [class.invalid]="registroForm.get('nacionalidad')?.invalid && registroForm.get('nacionalidad')?.touched"
        >
        <div class="validation-error" *ngIf="registroForm.get('nacionalidad')?.invalid && registroForm.get('nacionalidad')?.touched">
          <span *ngIf="registroForm.get('nacionalidad')?.errors?.['required']">La nacionalidad es requerida</span>
        </div>
      </div>

      <div class="form-group">
        <label for="fechaNacimiento">Fecha de Nacimiento:</label>
        <input 
          type="date" 
          id="fechaNacimiento" 
          formControlName="fechaNacimiento"
          [class.invalid]="registroForm.get('fechaNacimiento')?.invalid && registroForm.get('fechaNacimiento')?.touched"
          [max]="maxDate"
        >
        <div class="validation-error" *ngIf="registroForm.get('fechaNacimiento')?.invalid && registroForm.get('fechaNacimiento')?.touched">
          <span *ngIf="registroForm.get('fechaNacimiento')?.errors?.['required']">La fecha de nacimiento es requerida</span>
          <span *ngIf="registroForm.get('fechaNacimiento')?.errors?.['edadMinima']">Debes tener al menos 18 años para registrarte</span>
        </div>
      </div>

      <div class="error-message" *ngIf="registroError">
        {{ errorMessage }}
      </div>

      <button type="submit" [disabled]="!registroForm.valid">Registrarse</button>
      
      <div class="login-link">
        ¿Ya tienes una cuenta? <a (click)="goToLogin()">Inicia sesión aquí</a>
      </div>
    </form>
  </div>
</div>
